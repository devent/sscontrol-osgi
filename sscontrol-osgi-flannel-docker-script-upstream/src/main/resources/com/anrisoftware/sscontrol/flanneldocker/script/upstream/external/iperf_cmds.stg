/*
 * Starts iperf server. Returns the name and IP address of the container.
 */
startServer(parent, vars) ::= <<
container_id=\$(docker run -d -p 5201:5201 moutten/iperf:latest)
container_addr=\$(docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' \$container_id)
echo "Container: \${container_id}; Address: \${container_addr}"
>>

/*
 * Stops the iperf server.
 *
 * Mandatory:
 *
 * vars.container.name
 */
stopServer(parent, vars) ::= <<
docker rm -f <vars.container.name>
>>

/*
 * Starts iperf client.
 *
 * Mandatory:
 *
 * vars.container.address
 */
startClient(parent, vars) ::= <<
docker run --rm moutten/iperf:latest iperf3 -c <vars.container.address>
>>

