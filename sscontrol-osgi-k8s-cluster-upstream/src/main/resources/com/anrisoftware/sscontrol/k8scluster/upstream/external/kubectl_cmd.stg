setupKubectl(parent, vars) ::= <<
<setCluster(parent, vars)>
<setCredentials(parent, vars)>
<setContext(parent, vars)>
<vars.cluster.kubectlCmd> config use-context default-system

>>

setCluster(parent, vars) ::= <<
<vars.cluster.kubectlCmd> config set-cluster default-cluster --server=https://${MASTER_HOST} <kubeCa(parent, vars)>

>>

setCredentials(parent, vars) ::= <<
<vars.cluster.kubectlCmd> config set-credentials default-admin <kubeCa(parent, vars)> <kubeCert(parent, vars)> <kubeKey(parent, vars)>

>>

setContext(parent, vars) ::= <<
<vars.cluster.kubectlCmd> config set-context default-system --cluster=default-cluster --user=default-admin

>>

kubeCa(parent, vars) ::= <%
<if(vars.cluster.clusterTls.ca)>--certificate-authority=<vars.cluster.certsDir>/<vars.cluster.clusterTls.caName><endif>
%>

kubeCert(parent, vars) ::= <%
<if(vars.cluster.clientTls.cert)>--client-certificate=<parent.certsDir>/<vars.cluster.clientTls.certName><endif>
%>

kubeKey(parent, vars) ::= <%
<if(vars.cluster.clientTls.key)>--client-key=<parent.certsDir>/<vars.cluster.clientTls.keyName><endif>
%>

kubectlCmd(parent, vars) ::= <<
<setupKubectl(parent, vars)>
<vars.cluster.kubectlCmd> <vars.args>

>>
