installCmd(parent, vars) ::= <<
cd /tmp
tar xf "<parent.archiveFile>"
sudo mkdir -p '<parent.binDir>'
sudo mv flanneld '<parent.binDir>'
sudo chown root.root '<parent.binDir>/flanneld'
sudo chmod -w '<parent.binDir>/flanneld'
sudo mkdir -p '<parent.libexecDir>'
sudo mv mk-docker-opts.sh '<parent.libexecDir>'
sudo chown root.root '<parent.libexecDir>/mk-docker-opts.sh'
sudo chmod -w '<parent.libexecDir>/mk-docker-opts.sh'
curl <curlCerts(parent, vars)> -X PUT -d "value={\"Network\":\"<parent.service.network>\",\"Backend\":{\"Type\":\"<parent.service.backend.type>\"}}" "<parent.service.etcd.address>/v2/keys<parent.service.etcd.prefix>/config"

>>

curlCerts(parent, vars) ::= <%
<if(parent.service.etcd&&parent.service.etcd.tls.ca)> --ca "<parent.certsDir>/<parent.service.etcd.tls.caName>"<endif>
<if(parent.service.etcd&&parent.service.etcd.tls.cert)> --cert "<parent.certsDir>/<parent.service.etcd.tls.certName>"<endif>
<if(parent.service.etcd&&parent.service.etcd.tls.key)> --key "<parent.certsDir>/<parent.service.etcd.tls.keyName>"<endif>
%>
